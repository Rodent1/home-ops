apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: zitadel
  namespace: security
spec:
  interval: 30m
  chart:
    spec:
      chart: zitadel
      version: 5.0.0
      sourceRef:
        kind: HelmRepository
        name: zitadel
        namespace: flux-system
  values:
    replicaCount: 3
    image:
      repository: ghcr.io/zitadel/zitadel
      tag: v2.30.0:sha256:97ba35342aba01622d9a1f80bc785ab6d22a41b502f4626e684e8e81add684e9
      pullPolicy: IfNotPresent
    zitadel:
      masterkey: ${ZITADEL_MASTERKEY}
      configSecretName: zitadel-config
      dbSslRootCrt: false
      dbSslRootCrtSecret: false
      dbSslClientCrtSecret: false
    env:
      ZITADEL_DATABASE_POSTGRES_HOST: postgres-rw.database.svc.cluster.local
      ZITADEL_DATABASE_POSTGRES_PORT: "5432"
      ZITADEL_DATABASE_POSTGRES_DATABASE: zitadel
      ZITADEL_DATABASE_POSTGRES_USER_SSL_MODE: disable
      ZITADEL_DATABASE_POSTGRES_ADMIN_SSL_MODE: disable
    envFrom:
      - secretRef:
          name: zitadel-secret
